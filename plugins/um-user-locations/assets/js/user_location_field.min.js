var um_locations_maps={},um_locations_maps_view={},um_locations_map_markers={},um_locations_map_view_markers={};function UMLocationSelectOnEnter(l){var t=l.addEventListener?l.addEventListener:l.attachEvent;function a(a,e){if("keydown"===a){var o=e;e=function(a){var e=0<jQuery(".pac-item-selected").length;if(13===a.which&&!e){var t=jQuery.Event("keydown",{keyCode:40,which:40});o.apply(l,[t]),$selected_autocomplete=jQuery(l)}o.apply(l,[a])}}t.apply(l,[a,e])}l.addEventListener?l.addEventListener=a:l.attachEvent&&(l.attachEvent=a)}function UMplaceMarker(t,a,e){if(!um_locations_map_markers[e]){var o={map:um_locations_maps[e],draggable:!1};um_locations_map_markers[e]=new google.maps.Marker(o)}um_locations_map_markers[e].setPosition({lat:t.lat(),lng:t.lng()});var l=jQuery(".um-form-field[data-key="+e+"]");a.panTo(t),geocoder=new google.maps.Geocoder,geocoder.geocode({latLng:new google.maps.LatLng(t.lat(),t.lng()),region:um_user_location_var.region},function(a,e){e==google.maps.GeocoderStatus.OK&&void 0!==a[0].formatted_address&&(l.val(a[0].formatted_address),l.siblings(".um_lat_param").val(t.lat()),l.siblings(".um_lng_param").val(t.lng()),l.siblings(".um_url_param").val("https://www.google.com/maps/search/?api=1&query="+t.lat()+","+t.lng()))})}function UMInitUserLocationAutocomplete(){var n;jQuery(".um-user-locations-map-field-view").length&&jQuery(".um-user-locations-map-field-view").each(function(){if(""!==jQuery(this).data("lat")&&""!==jQuery(this).data("lng")){var a=jQuery(this).parents(".um-field").data("key"),e=wp.hooks.applyFilters("um_user_locations_map_field_args_init",{center:{lat:parseFloat(jQuery(this).data("lat")),lng:parseFloat(jQuery(this).data("lng"))},zoom:parseInt(um_user_location_var.start_coords.zoom),fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1},a);um_locations_maps_view[a]=new google.maps.Map(jQuery(this).get(0),e),um_locations_map_view_markers[a]=new google.maps.Marker({position:{lat:parseFloat(jQuery(this).data("lat")),lng:parseFloat(jQuery(this).data("lng"))},map:um_locations_maps_view[a],draggable:!1})}}),jQuery(document.body).on("keyup",".um_user_location_g_autocomplete",function(){""===jQuery(this).val()&&(jQuery(this).siblings(".um_lat_param").val(""),jQuery(this).siblings(".um_lng_param").val(""),jQuery(this).siblings(".um_url_param").val(""),jQuery(this).siblings(".um_user_location_g_autocomplete_map").length&&(um_locations_map_markers[jQuery(this).data("key")].setMap(null),delete um_locations_map_markers[jQuery(this).data("key")]))}),jQuery(".um_user_location_g_autocomplete").each(function(){if(UMLocationSelectOnEnter(jQuery(this).get(0)),!jQuery(this).parents(".um-directory").length){var a=wp.hooks.applyFilters("um_user_locations_autocomplete_args",{types:["geocode"]},!1,jQuery(this)),e=new google.maps.places.Autocomplete(jQuery(this).get(0),a);if(jQuery(this).siblings(".um_user_location_g_autocomplete_map").length){var t=!1,o={lat:parseFloat(um_user_location_var.start_coords.lat),lng:parseFloat(um_user_location_var.start_coords.lng)};""!==jQuery(this).siblings(".um_lat_param").val()&&""!==jQuery(this).siblings(".um_lng_param").val()&&(t=!0,o={lat:parseFloat(jQuery(this).siblings(".um_lat_param").val()),lng:parseFloat(jQuery(this).siblings(".um_lng_param").val())}),um_locations_maps[jQuery(this).data("key")]=new google.maps.Map(jQuery(this).siblings(".um_user_location_g_autocomplete_map").get(0),{center:o,zoom:parseInt(um_user_location_var.start_coords.zoom),fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1});var l={map:um_locations_maps[jQuery(this).data("key")],draggable:!1};t&&(l.position={lat:parseFloat(jQuery(this).siblings(".um_lat_param").val()),lng:parseFloat(jQuery(this).siblings(".um_lng_param").val())}),um_locations_map_markers[jQuery(this).data("key")]=new google.maps.Marker(l);var r=um_locations_maps[jQuery(this).data("key")],s=jQuery(this).data("key");google.maps.event.addListener(r,"click",function(a){UMplaceMarker(a.latLng,r,s)})}e.addListener("place_changed",function(a){var e=this.getPlace();if(void 0!==e&&void 0!==e.geometry&&void 0!==e.geometry.location){var t=e.geometry.location.lat(),o=e.geometry.location.lng();if(void 0!==n&&(n.siblings(".um_lat_param").val(t),n.siblings(".um_lng_param").val(o),n.siblings(".um_url_param").val(e.url),n.siblings(".um_user_location_g_autocomplete_map").length)){if(um_locations_maps[n.data("key")].setCenter({lat:parseFloat(t),lng:parseFloat(o)}),um_locations_maps[n.data("key")].fitBounds(e.geometry.viewport),!um_locations_map_markers[n.data("key")]){var l={map:um_locations_maps[n.data("key")],draggable:!1};um_locations_map_markers[n.data("key")]=new google.maps.Marker(l)}um_locations_map_markers[n.data("key")].setPosition({lat:parseFloat(t),lng:parseFloat(o)})}}else void 0!==n&&(n.siblings(".um_lat_param").val(""),n.siblings(".um_lng_param").val(""),n.siblings(".um_url_param").val(""))})}}).on("click",function(){n=jQuery(this)}),wp.hooks.doAction("um_member_directory_init_autocomplete")}!function(r){function s(a,e){um_locations_maps[a].setCenter({lat:parseFloat(e.lat),lng:parseFloat(e.lng)}),um_locations_map_markers[a].setPosition({lat:parseFloat(e.lat),lng:parseFloat(e.lng)})}r(document).ready(function(){jQuery(document.body).on("keypress, keyup, keydown",".um-form",function(a){jQuery(a.target).parents(".um-field").hasClass("um-field-textarea")||13===a.which&&a.preventDefault()}),r(document.body).on("click",".um_current_user_location",function(){var o=r(this);if(0<o.parents(".um-member-directory-map-controls").length)o.parents(".um-directory");var l=o.siblings(".um_user_location_g_autocomplete");return!navigator.geolocation&&um_user_location_var.is_ssl||navigator.geolocation.getCurrentPosition(function(t){void 0!==t.coords&&(geocoder=new google.maps.Geocoder,geocoder.geocode({latLng:new google.maps.LatLng(t.coords.latitude,t.coords.longitude),region:um_user_location_var.region},function(a,e){e==google.maps.GeocoderStatus.OK?void 0!==a[0].formatted_address&&(l.val(a[0].formatted_address),o.siblings(".um_lat_param").val(t.coords.latitude),o.siblings(".um_lng_param").val(t.coords.longitude),o.siblings(".um_url_param").val("https://www.google.com/maps/search/?api=1&query="+t.coords.latitude+","+t.coords.longitude),o.siblings(".um_user_location_g_autocomplete_map").length&&s(l.data("key"),{lat:t.coords.latitude,lng:t.coords.longitude})):(r.support.cors=!0,r.ajax({url:"https://freegeoip.app/json/",type:"GET",crossDomain:!0,dataType:"jsonp",success:function(a){void 0!==a.country_name?(o.prev().val(a.country_name+","+a.region_name+","+a.city),o.siblings(".um_lat_param").val(a.latitude),o.siblings(".um_lng_param").val(a.longitude),o.siblings(".um_url_param").val("https://www.google.com/maps/search/?api=1&query="+a.latitude+","+a.longitude),o.siblings(".um_user_location_g_autocomplete_map").length&&s(l.data("key"),{lat:a.latitude,lng:a.longitude})):alert(wp.i18n.__("Can not get your current location","um-user-locations"))},error:function(a){alert(wp.i18n.__("Can not get your current location","um-user-locations"))}}))}))}),!1})})}(jQuery);var um_ul_script=document.createElement("script");um_ul_script.src="//maps.googleapis.com/maps/api/js?key="+um_user_location_var.api_key+"&libraries=places&callback=UMInitUserLocationAutocomplete",um_user_location_var.region&&(um_ul_script.src+="&language="+um_user_location_var.region),document.body.appendChild(um_ul_script),wp.hooks.addAction("um_profile_completeness_popup_loaded","um_user_locations",function(a){UMInitUserLocationAutocomplete()}),wp.hooks.addFilter("um_profile_completeness_save_field_value","um_user_locations",function(a,e,t,o){return o.find('input[data-key="'+t+'_lat"]').length&&((a={})[t]=o.find('input[data-key="'+t+'"]').val(),a[t+"_lat"]=o.find('input[data-key="'+t+'_lat"]').val(),a[t+"_lng"]=o.find('input[data-key="'+t+'_lng"]').val(),a[t+"_url"]=o.find('input[data-key="'+t+'_url"]').val()),a},10);